<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>云项目详细</title>
    <script src="../../../JS/YunConfig.js"></script>

    <!--共用样式表-->
    <link href="../../../CSS/TPL.SIZE.PC.1080.css" rel="stylesheet" />
    <link href="../../../CSS/TPL.Font.css" rel="stylesheet" />
    <link href="../../../CSS/TPL.Color.css" rel="stylesheet" />
    <link href="../../../CSS/TPL.Comment.css" rel="stylesheet" />

    <!--Detail页面样式-->
    <link href="../../../CSS/TPL.Detail.css" rel="stylesheet" />

    <!--基础JS-->
    <script src="../../../JS/Base/jquery-3.1.1.min.js"></script>
    <script src="../../../JS/Base/PARAM_CHECKER.js"></script>
    <script src="../../../JS/Base/DEBUG.js"></script>
    <script src="../../../JS/Base/Convertor.js"></script>
    <script src="../../../JS/Base/NET.js"></script>
    <!--base64加密-->
    <script src="../../../JS/Base/CryptoJS/core-min.js"></script>
    <script src="../../../JS/Base/CryptoJS/enc-base64-min.js"></script>

    <!--SESSION相关-->
    <script src="../../../JS/jquery.cookie.js"></script>
    <script src="../../../JS/SESSION.js"></script>

    <!--ZTree组件-->
    <link href="../../../JS/Base/zTree/css/zTreeStyle/zTreeStyle.css" rel="stylesheet" />
    <script src="../../../JS/Base/zTree/js/jquery.ztree.all.js"></script>




    <link href="CSS/milestone.css" rel="stylesheet" />
    <script src="JS/MileStone.js"></script>

    <script src="../../../JS/ueditor/ueditor.config.js"></script>
    <script src="../../../JS/ueditor/ueditor.all.js"></script>
    <script src="../../../JS/ueditor/lang/zh-cn/zh-cn.js"></script>


    <link href="../../../JS/Base/jquery-ui-1.12.1/jquery-ui.structure.css" rel="stylesheet" />
    <link href="../../../JS/Base/jquery-ui-1.12.1/jquery-ui.theme.css" rel="stylesheet" />
    <script src="../../../JS/Base/jquery-ui-1.12.1/jquery-ui.js"></script>

    <!--共用业务JS-->
    <script src="../../../JS/TPL/TPL.Initial.js"></script>
    <script src="../../../JS/TPL/TPL.App.js"></script>
    <script src="../../../JS/TPL/TPL.Category.js"></script>
    <script src="../../../JS/TPL/TPL.ClientUI.js"></script>
    <script src="../../../JS/TPL/TPL.Nav.SummaryList.js"></script>
    <script src="../../../JS/TPL/TPL.Nav.Ztree.js"></script>
    <script src="../../../JS/TPL/TPL.Table.js"></script>
    <script src="../../../JS/TPL/TPL.View.js"></script>

    <!--自定业务-->
    <script src="JS/Doc.LeftMenu.js"></script>
    <script src="JS/Doc.TopButton.js"></script>
    <script src="JS/Doc.Detail.js"></script>
    <script src="JS/Doc.Biz.js"></script>



</head>
<body>
    <input type="hidden" id="ID" data-FormName="Default" data-propertyName="ID" />
    <input type="hidden" id="pageName" value="Detail" />
    <div class="global">
        <div class="title"><input type="text" placeholder="请输入项目标题" data-FormName="Default" data-propertyName="Title" data-propertyValue="" onkeyup="$(this).attr('data-propertyValue', $(this).val());" onchange="$(this).attr('data-propertyValue', $(this).val());" /></div>
        <script id="editor" type="text/plain" style="width:1024px;">
        </script>
        <div class="options">
            <ul>

                <li>
                    <div class="item">
                        <div class="key">分类</div>
                        <div class="value" data-FormName="Default" data-propertyName="ParentID" data-propertyValue="">
                            <a href="javascript:;" class="button w20em txtleft" onclick="$('#category').toggle();" id="parentNode" data-FormName="Default" data-propertyName="ParentName" data-propertyValue="">未选择项目分类</a>
                            <div style="position: absolute;z-index:9999;">
                                <div id="category" class="dropdownlist">
                                </div>
                            </div>
                        </div>
                        <div class="inputcheck cred">
                            检查信息
                        </div>
                    </div>
                </li>
                <li style="display:none;">
                    <div class="item">
                        <div class="key">添加组织</div>
                        <div class="value" data-FormName="Default" data-propertyName="OrgAllowedArray" data-propertyValue="" data-propertyType="CheckBoxArray">
                            <a href="javascript:;" class="button w20em txtleft" onclick="$('#category2').toggle();" id="parentNode" data-FormName="Default" data-propertyName="ParentName" data-propertyValue="">默认分类</a>
                            <div style="position: absolute;">
                                <div id="category2" class="dropdownlist">
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="item">
                        <div class="key">添加人员</div>
                        <div class="value" data-FormName="Default" data-propertyName="UserAllowedArray" data-propertyValue="" data-propertyType="CheckBoxArray">
                            <a href="javascript:;" class="button w20em txtleft" onclick="$('#category3').toggle();" data-FormName="Default" data-propertyName="UserAllowedArrayText" data-propertyValue="">未选择项目组成员</a>
                            <div style="position: absolute;z-index:9999;">
                                <div id="category3" class="dropdownlist">
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                <li style="display:none;">
                    <div class="item">
                        <div class="key">添加角色</div>
                        <div class="value" data-FormName="Default" data-propertyName="RoleAllowedArray" data-propertyValue="" data-propertyType="CheckBoxArray">
                            <a href="javascript:;" class="button w20em txtleft" onclick="$('#category4').toggle();" id="parentNode" data-FormName="Default" data-propertyName="ParentName" data-propertyValue="">默认分类</a>
                            <div style="position: absolute;">
                                <div id="category4" class="dropdownlist">
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>

        <div>
            <h1>项目进度设置</h1>
            <ul id="milestone"></ul>
        </div>
        <div class="buttons">
            <a href="jajavscript:;" class="btn" onclick="Doc.SaveDetail()">保存</a>
            <a href="jajavscript:;" class="btn" onclick="Doc.RemoveDetail()">删除</a>
            <a href="jajavscript:;" class="btn" onclick="$(window.parent.document).find('#detailWindow').hide(); window.close();">取消</a>
        </div>
        <div class="comment">
            <h2>项目组成员交流区</h2>
            <div class="input"> <textarea id="comment"></textarea><a href="javascript:;" onclick="Doc.AddComment()">提交</a></div>
            <div id="message"><div>评论成功....</div></div>
            <ul id="commentList"></ul>
            <a href="javascript:;" id="loadMore" onclick="Doc.LoadCommentList()">加载更多....</a>
        </div>
    </div>



    <div id="modal"></div>
    <div id="dialog">
        <div class="title">标题</div>
        <div class="message">操作成功！</div>
        <div class="bottom"><a href="javascript:;" onclick="$('#modal').hide();$('#dialog').hide()">取消</a><a href="javascript:;" onclick="$('#modal').hide();$('#dialog').hide()">关闭</a><a href="javascript:;" onclick="$('#modal').hide();$('#dialog').hide()">确定</a></div>
    </div>

    <script type="text/html" id="tplDroplistHeader">
        <div class='txtright'>
            <a href='javascript:;' class='margin_r05em' onclick="Doc.CancelCheckAllNodes($(this).parents('.dropdownlist').find('.ztree').attr('id'));$('[data-propertyname=UserAllowedArrayText]').text('未选择参与人员')">清空</a>
            <a href='javascript:;' class='margin_r05em' onclick="$('#category3').toggle();">确定</a>
            <a href='javascript:;' class='margin_r05em' onclick="Doc.CancelCheckAllNodes($(this).parents('.dropdownlist').find('.ztree').attr('id')); $('[data-propertyname=UserAllowedArrayText]').text('未选择参与人员');$('#category3').toggle();">取消</a>
        </div>
    </script>

    <script type="text/html" id="tpl_Milestone_1">
        <li>
            <div class="checkpoint">
                <input type="text" placeholder="简述时间节点任务" data-propertyName="Title" />
                <span class="separator">|</span><span class="progress"> <input type="text" placeholder="请填写计划开始时间" data-propertyName="Summary" /></span>
                <a href="javascript:;" class="addbtn" onclick="$(this).parents('li').remove();">删除</a>
            </div>
            <ul>
                <li>
                    <a href="javascript:;" class="addbtn" onclick="Milestone.AddTask()">添加新任务</a>
                </li>
            </ul>
        </li>
    </script>
    <script type="text/html" id="tpl_Milestone_2">
        <li>
            <div class="row">
                <div class="content"><input type="text" value="简述要完成的工作项2"></div>
                <div class="info"><span class="status">未开始<input type="hidden" data-propertyName="Status" value="未开始" /></span><span class="time"> <input type="text" value="请填写预计结束时间"> </span><a href="javascript:;" class="btn" onclick="$(this).parents('li').remove();">删除</a></div>
            </div>
        </li>
    </script>
    <script type="text/html" id="tpl_Milestone_3">
        <li>
            <div class="row">
                <div class="content" data-propertyName="Title" data-propertyValue="[Title]">[Title]</div>
                <div class="info">
                    <span class="status" data-propertyName="Status" data-propertyValue="已完成">已完成</span>
                    <span class="time" data-propertyName="ExpectedStopTime" data-propertyValue="[ExpectedStopTime]">[ExpectedStopTime]</span>
                    <span class="time" data-propertyName="ActualStopTime" data-propertyValue="[ActualStopTime]">实际[ActualStopTime]结束</span>
                </div>
            </div>
        </li>
    </script>
    <script type="text/html" id="tpl_Milestone_4">
        <li>
            <div class="row" >
                <div class="content" data-propertyName="Title" data-propertyValue="[Title]">[Title]</div>
                <div class="info">
                    <span class="status">进行中<input type="hidden" data-propertyName="Status" value="进行中" /></span>
                    <span class="time" data-propertyName="ExpectedStopTime" data-propertyValue="[ExpectedStopTime]">[ExpectedStopTime]</span>
                    <a href="javascript:;" class="btn" data-propertyName="ID" data-propertyValue="[ID]" onclick="Milestone.CompleteTask()">确认完成</a>
                </div>
            </div>
        </li>
    </script>
    <script type="text/html" id="tpl_Milestone_5">
        <li>
            <div class="row">
                <div class="content" data-propertyName="Title" data-PropertyValue="[Title]">[Title]</div>
                <div class="info"><span class="status" data-propertyName="Status" data-propertyValue="进行中">进行中</span><span class="time" data-propertyName="ExpectedStopTime" data-PropertyValue>[ExpectedStopTime]</span>
                <a href="javascript:;" class="btn" data-propertyName="ID" data-propertyValue="[ID]"  onclick="Milestone.CompleteTask()">确认完成</a></div>
            </div>
        </li>
    </script>
    <script type="text/html" id="tpl_Milestone_6">
        <li>
            <h2 class="checkpoint">
                <span class="title" data-propertyName="Title" data-propertyValue="[Title]">[Title]</span>
                <span class="separator">|</span>
                <span class="progress" data-propertyName="Summary" data-propertyValue="[Summary]">[Summary]</span>
            </h2>
            <ul>
                <li>
                    <a href="javascript:;" class="addbtn" onclick="Milestone.AddTask()">添加新任务</a>
                </li>
            </ul>
        </li>

    </script>
    <script type="text/html" id="tpl_Milestone_7">
        <li>
            <div class="row">
                <div class="content"><input type="text" placeholder="简述要完成的工作项7" data-propertyName="Title"></div>
                <div class="info"><span class="status">未开始<input type="hidden" data-propertyName="Status" value="未开始" /></span><span class="time"> <input type="text" data-propertyName="ExpectedStopTime" placeholder="请填写预计结束时间"> </span><a href="javascript:;" class="btn" onclick="$(this).parentsUntil('ul').remove();">删除</a></div>
            </div>
        </li>
    </script>


    <script type="text/html" id="tplCommentItem">
        <li>
            <div class="commentItem">
                <div class="header"><a href="javascript:;">[CreatorName]</a><span>[CreateTime]</span></div>
                <div class="content"><p>[Content]</p></div>
                <div class="footer"><a href="javascript:;">回复</a><a href="javascript:;">相关说说</a><a href="javascript:;" onclick="TouTiao.AddLikeCount()">点赞[LikeCount]</a></div>
            </div>
        </li>
    </script>

 

    <script type="text/javascript">
        ///初始化
        $(document).ready(function () {
            $(document).tooltip();

            var adminCallback = function () {
 
            }
            var clientCallback = function () {
                $(".global").width(window.parent.$("#content").width() - 30);
                UE.getEditor('editor', { initialFrameWidth: $(".global").width() }); ///创建编辑器
                 
                Doc.LoadData_Category([JSON.stringify({OwnerID:SESSION.Current().UserID}), "{}", "{}", 0, 1000], function (res1) {
                    Doc.LoadTreeTo("#category", res1, [], {
                        Click: function (event, treeId, treeNode) {
                            var name = treeNode.Name;
                            $('#category').hide();
                            $("[data-propertyName='ParentID']").attr("data-propertyValue", treeNode.id);
                            $("[data-propertyName='ParentName']").attr("data-propertyValue", name);
                            $("[data-propertyName='ParentName']").text(name);

                        },
                        header: "<div class='margin_l05em fontweight700'>请选择分类</div>",
                    });
                }); ///加载目录

                Doc.LoadData_All([], function (res1) {
                    Doc.LoadTreeTo("#category3", res1, [], {
                        ShowMode: "checkbox", Check: function (event, treeId, treeNode) { }
                        , header: $("#tplDroplistHeader").html()
                        , Check: function (event, treeId, treeNode) {
                            var idArray = Doc.GetCheckedTreeNodes(treeId);
                            var fix = (0 < idArray.length) ? " 等" : " ";
                            $("[data-propertyName='UserAllowedArrayText']").text("已选中 " + treeNode.Name + fix + idArray.length + "人");
                            $("[data-propertyName='UserAllowedArrayText']").attr("data-propertyvalue", "已选中 " + treeNode.Name + fix + idArray.length + "人");
                        },
                    });
                    

                }); ///加载目录
                Doc.LoadDetail();
                Milestone.LoadData();
                Doc.LoadCommentList(0);
            }
            Doc.Initial(SESSION.Current().CanManageYunProject, clientCallback, clientCallback);//初始化
        });

    </script>

</body>
</html>
